<html>
<head>
<title>rMate Flash Grid</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javaScript" src="./JS/AC_OETags.js"></script>
<script type="text/javaScript" src="./JS/rMateGrid.js"></script>
<script type="text/javaScript" src="./JS/rMateGridLicense.js"></script>
<style>
body { margin: 0px; font-family: "굴림", "굴림체"; }
</style>

<!-- 사용자 정의 설정 시작 -->
<script type="text/javascript">

// ----------------------- rMateGrid flashVars 설정 시작 -----------------------

// rMateGrid 레이아웃 URL 경로. 반드시 설정하십시오.
var layoutURL = encodeURIComponent("./LayoutXml/LayoutEditingItemChangedEvent.xml");
var flashVars = "layoutURL="+layoutURL;

// 데이타를 URL 경로를 통해 가져올 경우 설정하십시오.
// 배열형태로 데이터를 삽입할 경우 주석처리나 삭제하십시오.
// 배열형태와 같이 사용할 경우, 우선순위는 배열형태 데이터 삽입입니다.
var dataURL = encodeURIComponent("./DataXml/DataOneDepthMailSend.txt");
flashVars += "&dataURL="+dataURL;

// 데이타가 JSON형일 경우 넣어줍니다. (설정을 안할경우 xml로 인식하여 오류가 발생합니다)
flashVars += "&dataType=json";

// ----------------------- rMateGrid flashVars 설정 끝 -----------------------

// rMateGrid 관련 객체
var gridApp;	// 플래시 기본 객체
var gridRoot;	// 데이타와 그리드를 포함하는 객체
var dataGrid;	// 그리드

var collection;	// 그리드의 데이타 객체

// rMateGrid가 로딩된 후 불려지는 함수
var rMateGridOnLoad = function() {
	gridApp = FABridge.gridBridge.root();
	gridRoot = gridApp.getGridRoot();

	var menuItemSelectedHandler = function(event) {
		contextMenuHandler(event.getMenuItemCaption());
	}
	var layoutCompleteHandler = function(event) {
		dataGrid = gridApp.getDataGrid();
		dataGrid.addEventListener("gridMenuItemSelect", menuItemSelectedHandler);
	}

	gridRoot.addEventListener("layoutComplete", layoutCompleteHandler);
	gridRoot.addEventListener("itemDataChanged", itemDataChangeHandler);
}

// rMateGrid가 로딩된 후 불려질 함수를 설정합니다.
FABridge.addInitializationCallback("gridBridge", rMateGridOnLoad);

function contextMenuHandler(caption) {
	if (caption == "Insert Row") {
		var item = {"Selected": false,"From": "James","Subject": "GMC-2 Release1","ReceiveDate": "2007/05/23","SendDate": "2007/05/22","CC": "Marry","Length": 52433,"Level": 2,"AttachCount": 2};
		gridRoot.addItemAt(item, dataGrid.getSelectedIndex());
	} else if (caption == "Delete Row")
		gridRoot.removeItemAt(dataGrid.getSelectedIndex());
}

// 그리드에서 수정이 일어나면 불려집니다.
function itemDataChangeHandler(event) {
	var rowIndex = event.getRowIndex();					// 변경된 행번호
	var columnIndex = event.getColumnIndex();		// 변경된 열번호
	var dataField = event.getDataField();				// 변경된 열의 데이타 필드
	var dataRow = gridRoot.getItemAt(rowIndex);	// 변경된 데이타 레코드
	var oldValue = event.getValue();						// 변경전 값
	var newValue = event.getNewValue();					// 변경후 값

	inputForm.changeRowIndex.value = rowIndex;
	inputForm.changeColumnIndex.value = columnIndex;
//	주의 : alert시 그리드 내부적으로 포커스를 잃어버려 두번 불려지게 됩니다.	
//	alert("itemDataChangeHandler rowIndex:"+rowIndex+" columnIndex:"+columnIndex+" oldValue:"+oldValue+" newValue:"+newValue);
}

// labelJsFunctin 기능을 이용하여 Selected 컬럼을 true/false대신 Yes,No로 바꿉니다.
function convertYesNo(item, value, column) {
	if (column.dataField == "Selected") {
		// 데이타가 xml인 경우에는 문자열 비교를 하셔야 합니다.
		if (value == true)
			return "Yes";
	 	else
			return "No";
	}
	return "";
}

// labelJsFunctin 기능을 이용하여 comboBox 컬럼의 코드를 코드명으로 바꿉니다.
function convertComboCode(item, value, column) {
	if (column.dataField == "Subject") {
		if (value == "GMC-1 Release1")
			return "GMC-1 R1";
		else if (value == "GMC-1 Release2")
			return "GMC-1 R2";
		else if (value == "GMC-1 Release3")
			return "GMC-1 R3";
		else if (value == "GMC-1 Release4")
			return "GMC-1 R4";
		else if (value == "GMC-1 Release5")
			return "GMC-1 R5";
		else if (value == "GMC-1 Release6")
			return "GMC-1 R6";
	 	else
			return value;
	}
	return "";
}
</script>
<!-- 사용자 정의 설정 끝  -->
</head>

<body onLoad="rMateGridInit()">
<table align="center" border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
	<tr height="80">
		<td width="7%"></td>
		<td align="center" valign="middle">
			<br>
			<b>그리드 편집시 변경 내역 받기</b>
		</td>
		<td width="7%"></td>
	</tr>
	<tr height="80">
		<td></td>
		<td align="center">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td align="center">컬럼의 셀을 더블클릭하여 수정을 하면 변경된 내역을 이벤트로 받을 수 있습니다.</td>
				</tr>
				<tr><td height="10"></td></tr>
				<tr>
					<td align="right">
					<form id="inputForm" name="inputForm">
						변경된 rowIndex <input name="changeRowIndex" size="3">
						columnIndex <input name="changeColumnIndex" size="3">
					</form>
					</td>
				</tr>
			</table>
		</td>
		<td></td>
	</tr>
	<tr>
		<td></td>
		<td align="center">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
				<tr>
					<td align="center">
						<script type="text/javascript">
						<!--
							rMateGridCreate("grid1", "../Component/rMateGridWeb", flashVars, "100%", "100%", "#FFFFFF");
						// -->
						</script>
					</td>
				</tr>
			</table>
		</td>
		<td></td>
	</tr>
	<tr height="100">
		<td></td>
		<td align="center" valign="middle">
			<a href="#" onClick="javascript:window.open(decodeURIComponent(layoutURL), '_blank', 'width=1024 height=768 scrollbars=yes')">
			<img src="./Images/viewLayout.png" width="100" height="22" border="0"/></a>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<a href="#" onClick="javascript:window.open(decodeURIComponent(dataURL), '_blank', 'width=1024 height=768 scrollbars=yes')">
			<img src="./Images/viewData.png" width="100" height="22" border="0"/></a>
		</td>
		<td></td>
	</tr>
</table>

</body>
</html>
