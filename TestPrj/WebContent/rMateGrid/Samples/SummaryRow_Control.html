<html>
<head>
<title>rMate Flash Grid</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javaScript" src="./JS/AC_OETags.js"></script>
<script type="text/javaScript" src="./JS/rMateGrid.js"></script>
<script type="text/javaScript" src="./JS/rMateGridLicense.js"></script>
<style>
body { margin: 0px; font-family: "굴림", "굴림체"; }
</style>

<!-- 사용자 정의 설정 시작 -->
<script type="text/javascript">

// ----------------------- rMateGrid flashVars 설정 시작 -----------------------

// rMateGrid 레이아웃 URL 경로. 반드시 설정하십시오.
var layoutURL = encodeURIComponent("./LayoutXml/LayoutSummaryRowControl.xml");
var flashVars = "layoutURL="+layoutURL;

// 데이타를 URL 경로를 통해 가져올 경우 설정하십시오.
// 배열형태로 데이터를 삽입할 경우 주석처리나 삭제하십시오.
// 배열형태와 같이 사용할 경우, 우선순위는 배열형태 데이터 삽입입니다.
var dataURL = encodeURIComponent("./DataXml/DataOneDepthRevenues.xml");
flashVars += "&dataURL="+dataURL;

// 데이타가 JSON형일 경우 넣어줍니다. (설정을 안할경우 xml로 인식하여 오류가 발생합니다)
//flashVars += "&dataType=json";

// ----------------------- rMateGrid flashVars 설정 끝 -----------------------

// rMateGrid 관련 객체
var gridApp;	// 플래시 기본 객체
var gridRoot;	// 데이타와 그리드를 포함하는 객체
var dataGrid;	// 그리드
var collection;	// 그리드의 데이타 객체

// rMateGrid가 로딩된 후 불려지는 함수
var rMateGridOnLoad = function() {
	gridApp = FABridge.gridBridge.root();
	gridRoot = gridApp.getGridRoot();

	var dataCompleteHandler = function(event) {
		dataGrid = gridApp.getDataGrid();
		collection = gridRoot.getCollection();
	}

	// 그리드에 데이타가 저장되면 불려지도록 설정
	gridRoot.addEventListener("dataComplete", dataCompleteHandler);
}

// rMateGrid가 로딩된 후 불려질 함수를 설정합니다.
FABridge.addInitializationCallback("gridBridge", rMateGridOnLoad);

function updateSummaryRow() {
	if (collection == null)
		collection = gridRoot.getCollection();
	if (collection == null) {
		alert("collection 객체를 찾을 수 없습니다");
		return;
	}

	// 데이타의 행에서 Seoul값을 가져와 전체합계에 대한 %를 구합니다.
	var clen = collection.getLength();
	var rowCount = 0;
	var allTotal = 0;
	// 전체 합산 찾기
	for (var i = clen - 1; i >= 0; i--) {
		var row = gridRoot.getItemAt(i);
		// 합산 레코드이면
		if (row.typeName == "net.riamore.rmate.collections::SpanSummaryObject") {
			if (row.get("Year") == "합계") {		// 전체 합산 레코드이면
				allTotal = row.get("Seoul");
				break;
			}
		}
	}
	// 백분율로 대체
	for (var i = 0; i < clen; i++) {
		var row = gridRoot.getItemAt(i);
		if (row.typeName == "net.riamore.rmate.collections::SpanSummaryObject") {
			if (row.get("Year") != "합계") {		// 전체 합산 레코드이 아니면
				var se = row.get("Seoul");
				if (se.toString().indexOf("%") < 0)
					row.set("Seoul", (se / allTotal * 100).toFixed(2) + "%");
			}
		}
	}
	// 그리드의 셀들을 다시 표시한다.
	dataGrid.invalidateList();
}

function addCommas(nStr) {
	nStr += '';
	x = nStr.split('.');
	x1 = x[0];
	x2 = x.length > 1 ? '.' + x[1] : '';
	var rgx = /(\d+)(\d{3})/;
	while (rgx.test(x1)) {
		x1 = x1.replace(rgx, '$1' + ',' + '$2');
	}
	return x1 + x2;
}

function formatSeoul(item, value, column) {
	var str = value.toString();
	if (str.indexOf("%") < 0 && str.indexOf(","))
		return addCommas(value);
	else
		return value;
}
</script>
<!-- 사용자 정의 설정 끝  -->
</head>

<body onLoad="rMateGridInit()">
<table align="center" border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
	<tr height="80">
		<td width="7%"></td>
		<td align="center" valign="middle">
			<br>
			<b>SpanSummaryCollection에 의해 합산된 레코드 제어</b>
		</td>
		<td width="7%"></td>
	</tr>
	<tr height="70">
		<td></td>
		<td align="center">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td align="center">SpanSummaryCollection에 의해 만들어진 합산을 찾아내고 변경시키는 예 입니다.<br> html의 소스를 통해 확인해 보시기 바랍니다.<br>
					합산 변경 버튼을 누르면 Seoul컬럼의 합산데이타가  백분율로 변경됩니다.
					</td>
				</tr>
				<tr><td height="10"></td></tr>
				<tr>
					<td align="right">
						<form id="inputForm" name="inputForm">
							<input type="button" value="합산 변경" onClick="updateSummaryRow()"/>
						</form>
					</td>
				</tr>
			</table>
		</td>
		<td></td>
	</tr>
	<tr>
		<td></td>
		<td align="center">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
				<tr>
					<td>
						<script type="text/javascript">
						<!--
							rMateGridCreate("grid1", "../Component/rMateGridWeb", flashVars, "100%", "100%", "#FFFFFF");
						// -->
						</script>
					</td>
				</tr>
			</table>
		</td>
		<td></td>
	</tr>
	<tr height="100">
		<td></td>
		<td align="center" valign="middle">
			<a href="#" onClick="javascript:window.open(decodeURIComponent(layoutURL), '_blank', 'width=1024 height=768 scrollbars=yes')">
			<img src="./Images/viewLayout.png" width="100" height="22" border="0"/></a>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<a href="#" onClick="javascript:window.open(decodeURIComponent(dataURL), '_blank', 'width=1024 height=768 scrollbars=yes')">
			<img src="./Images/viewData.png" width="100" height="22" border="0"/></a>
		</td>
		<td></td>
	</tr>
</table>

</body>
</html>
