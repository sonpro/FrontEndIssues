<html>
<head>
<title>rMate Flash Grid</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script type="text/javaScript" src="./JS/AC_OETags.js"></script>
<script type="text/javaScript" src="./JS/rMateGrid.js"></script>
<script type="text/javaScript" src="./JS/rMateGridLicense.js"></script>
<style>
body { margin: 0px; font-family: "굴림", "굴림체"; }
</style>

<!-- 사용자 정의 설정 시작 -->
<script type="text/javascript">

// ----------------------- rMateGrid flashVars 설정 시작 -----------------------

// rMateGrid 레이아웃 URL 경로. 반드시 설정하십시오.
var layoutURL = encodeURIComponent("./LayoutXml/LayoutEditingDataGrid.xml");
var flashVars = "layoutURL="+layoutURL;

// 데이타를 URL 경로를 통해 가져올 경우 설정하십시오.
// 배열형태로 데이터를 삽입할 경우 주석처리나 삭제하십시오.
// 배열형태와 같이 사용할 경우, 우선순위는 배열형태 데이터 삽입입니다.
var dataURL = encodeURIComponent("./DataXml/DataOneDepthSales.xml");
flashVars += "&dataURL="+dataURL;

// 데이타가 JSON형일 경우 넣어줍니다. (설정을 안할경우 xml로 인식하여 오류가 발생합니다)
//flashVars += "&dataType=json";

// ----------------------- rMateGrid flashVars 설정 끝 -----------------------

// rMateGrid 관련 객체
var gridApp;	// 플래시 기본 객체
var gridRoot;	// 데이타와 그리드를 포함하는 객체
var dataGrid;	// 그리드

// rMateGrid가 로딩된 후 불려지는 함수
var rMateGridOnLoad = function() {
	gridApp = FABridge.gridBridge.root();
	gridRoot = gridApp.getGridRoot();

	var menuItemSelectedHandler = function(event) {
		contextMenuHandler(event.getMenuItemCaption());
	}

	var layoutCompleteHandler = function(event) {
		dataGrid = gridApp.getDataGrid();
		dataGrid.addEventListener("gridMenuItemSelect", menuItemSelectedHandler);
	}

	gridRoot.addEventListener("layoutComplete", layoutCompleteHandler);
}

// rMateGrid가 로딩된 후 불려질 함수를 설정합니다.
FABridge.addInitializationCallback("gridBridge", rMateGridOnLoad);

function contextMenuHandler(caption) {
	if (caption == "Insert Row") {
		var item = "<Sale><Region>Nor</Region><Territory></Territory><Territory_Rep>Arizona</Territory_Rep><Actual>85412</Actual><Estimate></Estimate><Real>30000</Real><Price>3009</Price></Sale>"
		gridRoot.addItemAt(item, dataGrid.getSelectedIndex());
	} else if (caption == "Delete Row")
		gridRoot.removeItemAt(dataGrid.getSelectedIndex());
}

// 셀에 대한 수정이 시작될 때 불려지며(layout에서 설정), 셀의 수정가능 여부를 판별하여
// true면 수정가능, false면 수정불가가 됩니다.
// 수정 불가의 경우에는 해당 셀의 편집모드로 들어가지 전환되지 못합니다.
function itemEditBeginningChecker(rowIndex, columnIndex, item, dataField) {
	if (dataField != "Actual")
		return true;
	else
		return false;
}

// 셀에 대한 수정이 완료될 때 불려지며(layout에서 설정), 셀의 수정가능 여부를 판별하여
// 오류가 있으면 해당 메세지를 return합니다.
// 전달된 메세지는 해당 셀에 오류메세지로 표현되며, 계속 편집모드로 남게 됩니다.
function itemEditEndChecker(rowIndex, columnIndex, item, dataField, oldValue, newValue) {
	if (columnIndex > 3) {
		if (newValue > 100)
			return dataField + "값은 100보다 작아야 합니다.";
	}
}

// 전체 삭제
function removeAll() {
	gridRoot.removeAll();
}

// 맨끝에 행 추가
function addItem() {
	var item = "<Sale><Region>Nor</Region><Territory></Territory><Territory_Rep>Arizona</Territory_Rep><Actual>25431</Actual><Estimate></Estimate><Real>30000</Real><Price>3009</Price></Sale>"
	gridRoot.addItemAt(item);
}

// 수정 작업 결과 가져오기 (그리드에서 작업된 입력,수정,삭제 내용을 가져옵니다)
// 데이타는 배열 형태로
// 	idx: 행번호
//	job: 수행 작업 (I:입력, U:수정, D:삭제)
//	data: 행의 자료
// 를 가지고 있으며 삭제가 먼저 오도록 정렬되어 있습니다.
function getChangedData() {
	var changedData = gridRoot.getChangedData();
	if (changedData.length == 0)
		alert("변경된 자료가 없습니다");
	else {
		for (var i = 0; i < changedData.length; i++)
			alert("index:"+changedData[i].idx+"\n"+"job:"+changedData[i].job+"\n"+"data:"+changedData[i].data);
	}
}

// 수정 작업 결과 XML로 가져오기 (그리드에서 작업된 입력,수정,삭제 내용을 XML로 가져옵니다)
// 데이타는 XML 형태로
// 	idx: 행번호
//	job: 수행 작업 (I:입력, U:수정, D:삭제)
//	data: 행의 자료
// node를 가지고 있으며 삭제가 먼저 오도록 정렬되어 있습니다.
function getChangedDataXML() {
	var changedDataXML = gridRoot.getChangedDataXML();
	if (changedDataXML == null)
		alert("변경된 자료가 없습니다");
	else
		alert(changedDataXML);
}

</script>
<!-- 사용자 정의 설정 끝  -->
</head>

<body onLoad="rMateGridInit()">
<table align="center" border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
	<tr height="80">
		<td width="7%"></td>
		<td align="center" valign="middle">
			<br>
			<b>그리드내에서 데이타 편집</b>
		</td>
		<td width="7%"></td>
	</tr>
	<tr height="100">
		<td></td>
		<td align="center">
			<table border="0" cellpadding="0" cellspacing="0" width="100%">
				<tr>
					<td align="center">자바스크립트를 통해 수정가능 및 수정값 검증을 할 수 있습니다.<br>
					이 예에서는 Region컬럼은 editable속성이 false이며, Actual컬럼에 대해서 자바스크립트로 수정을 막으며,<br> Estimate이후 컬럼에 대해 100이상의 자료를 넣으면 오류메세지가 나타납니다.</td>
				</tr>
				<tr><td height="10"></td></tr>
				<tr>
					<td align="right">
						<input type="button" value="맨끝에 행 추가" onClick="addItem()"/>
						<input type="button" value="전체 삭제" onClick="removeAll()"/>
						<input type="button" value="수정내역 보기" onClick="getChangedData()"/>
						<input type="button" value="수정내역 XML로 보기" onClick="getChangedDataXML()"/>
					</td>
				</tr>
			</table>
		</td>
		<td></td>
	</tr>
	<tr>
		<td></td>
		<td align="center">
			<table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
				<tr>
					<td align="center">
						<script type="text/javascript">
						<!--
							rMateGridCreate("grid1", "../Component/rMateGridWeb", flashVars, "100%", "100%", "#FFFFFF");
						// -->
						</script>
					</td>
				</tr>
			</table>
		</td>
		<td></td>
	</tr>
	<tr height="100">
		<td></td>
		<td align="center" valign="middle">
			<a href="#" onClick="javascript:window.open(decodeURIComponent(layoutURL), '_blank', 'width=1024 height=768 scrollbars=yes')">
			<img src="./Images/viewLayout.png" width="100" height="22" border="0"/></a>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<a href="#" onClick="javascript:window.open(decodeURIComponent(dataURL), '_blank', 'width=1024 height=768 scrollbars=yes')">
			<img src="./Images/viewData.png" width="100" height="22" border="0"/></a>
		</td>
		<td></td>
	</tr>
</table>

</body>
</html>
